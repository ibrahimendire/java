 pipeline {
        agent any
                        

                        stages {
                            stage('Test') {
                                steps {
                                    sh 'mvn test'
                                }
                            }
                            stage('Build') {
                                steps {
                                    sh 'mvn clean install'
                                }
                            }
                            stage('SonarQube Analysis') {
                        def mvn = tool 'Default Maven';
                        withSonarQubeEnv() {
                        sh "${mvn}/bin/mvn clean verify sonar:sonar -Dsonar.projectKey=java"
                        }
                        stage('SonarQube analysis 2') {
                                steps {
                                    withSonarQubeEnv('SonarScanner') {
                                        sh "mvn sonar:sonar \
                                            -Dsonar.host.url=http://localhost:1010 \
                                            -Dsonar.projectKey=demo \
                                            -Dsonar.login=credentials('sonarqube') \
                                            -Dsonar.projectName='java' \
                                            -Dsonar.projectVersion=1.0.0 \
                                            -Dsonar.java.binaries=target/classes"
                                    }
                                }      
                        }

                        }
                        
                        
                            }  
                        /* post{
                                failure{
                                    
                                    
                                    slackSend( channel: "#ibrahim", token: "slack-jenkins-secret-key token", color: "danger", message: "Ibrahim sorry to hear that your Build is Failed: ${env.BUILD_DISPLAY_NAME} with Build ID: (${env.BUILD_ID}) ${custom_msg()}")
                                }
                                success {
                            slackSend(channel: "#ibrahim", 
                                    token: "slack-jenkins-secret-key token", 
                                    color: "good", 
                                    message: "Congragulation Ibrahim, Your Build is Succeeded: ${env.BUILD_DISPLAY_NAME} (${env.BUILD_ID})")
                        }
                            }
                            */
                    }

